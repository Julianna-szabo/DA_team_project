---
title: "Report"
output: pdf_document
---

```{r setup, include=FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
defaultW <- getOption("warn") 
options(warn = -1)
```

```{r, include=F, message=FALSE, echo=FALSE, eval=TRUE}
library(tidyverse)
library(geosphere)
library(moments)
library(dplyr)
library(knitr)
## Github Repo of Assignment: https://github.com/Julianna-szabo/DA_team_project
# Import data via URL
my_url <- "https://raw.githubusercontent.com/Julianna-szabo/DA_team_project/master/data/raw/dp.csv"
dp <- read_csv(my_url)
```
Authors: Group B,
Date: 21/10/2020

# Data collection

The data collection process was more difficult than expected. Most of the time coca cola in 0,5l was not available, instead of putting a NA we choose an alternative in 0,5l, pepsi or limonade. If those were not available, we took water or beer even though beer is usually more expensive. We decided to sort them in three categories : soft( Coca, Pepsi, Lemonade), water and beer. For the extra measures we recorded, numbers of pizzas they offered, opening hours (which we converted into minutes opened in this analysis and took the usual opening hours), as well as rating on Google and the number of ratings they received. The number of ratings is important since it gives the rating more credibility. We also recorded the longitude and latitude to calculate the distance from CEU and estimate the fairness of the delivery compare to the distance to CEU.


```{r, echo=FALSE, eval=TRUE, include=FALSE}
# Calculations for opening hours and distance from CEU
ceu = c(47.501348, 19.049375)
dp["dist_ceu"] = distm(data.matrix(dp[6:7]), ceu, fun = distHaversine)
distm(ceu, c(47.500386, 19.049434), fun=distHaversine)

get_interval <- function(open,close){
  intv = close-open
  if (intv < 0) {
    intv = as.difftime("24:00:00")-open+close
  }
  intv=as.numeric(as.difftime(intv,units = "hours"))/60
  return(intv)
}

dp$open_mins=mapply(get_interval, dp$open, dp$close)
```

# Descriptive Statistics

```{r, eval=TRUE, echo=FALSE, results='asis'}
dp_summary_stats_pizza <- summarise(dp,
          n= n(),
          mean = mean(x = price_marg),
          median = median(x = price_marg),
          min= min(price_marg),
          max = max(price_marg),
          sd = sd(price_marg),
          skew = skewness(price_marg))
dp_summary_stats_bev <- summarise(dp,
          n= n(),
          mean = mean(x = price_bev),
          median = median(x = price_bev),
          min= min(price_bev),
          max = max(price_bev),
          sd = sd(price_bev),
          skew = skewness(price_bev))

table_summary <- dp_summary_stats_pizza %>% 
  add_row(dp_summary_stats_bev) %>% 
  add_column(c('Product','Pizza Marg.','Beverage (0.5l)'))
kable(table_summary)
```

# Distributions
## Price of pizza margarite and beverage

```{r, echo=FALSE, figures-side, fig.show="hold", out.width="50%"}
dp %>% 
  ggplot(aes(x=price_marg))+
  geom_histogram(binwidth = 200, fill= "coral2", col= "black")+
  theme_bw()+
  labs(x = 'Price of Margarita Pizza (HUF)', y= 'Number of Pizzas', title = "Distribution of Price for Pizza")

dp %>% 
  ggplot(aes(x=price_bev, fill=category_bev))+
  geom_histogram(binwidth = 50, col= "black")+
  theme_bw()+
  scale_fill_brewer()+
  labs(x = 'Price of 0.5L beverage (HUF)', y= 'Number of Pizzas', title = "Distribution of Price for Beverage by category")
```

## Price distribution on-site vs delivery

```{r, echo=FALSE, out.width="70%"}
dp$category_f <- factor(dp$category)

ggplot(data = dp, aes(x = price_marg, fill = category_f, alpha = 0.2))+
  geom_density(binwidth = 200, col = "black")+
  labs(x='Price of Margarita Pizza (HUF)', y='Number of Pizzas', title = "Distribution of Price for On-site and Delivery", fill= 'category')

```
In order to avoid confusion on the analysis between On-site and Delivery, we took out the beverage and just analyse the margarita price. (Due to the beverages not being uniform)

# T-test
## Hypothesis
$$H_{0}: \bar{p_{o}}=\bar{p_{d}}$$
$$H_{1}: \bar{p_{o}}\neq\bar{p_{d}}$$

<!-- Null mean(on-site)=mean(delivery) -->
<!-- Alternative mean(on-site) not = mean(delivery) -->

```{r, echo=FALSE, results='asis', message=FALSE}
#install.packages('pander')

price_onsite <- dp$price_marg[dp$category=="On-site"]
price_delivery <- dp$price_marg[dp$category=="Delivery"]
library(pander)
pander(t.test(price_onsite,price_delivery, alternative = "two.sided"),conf.int =TRUE)
```

# Summary and Conclusion

Overall the distribution of price of the beverages has a larger range than the prices of the pizza. And overall the prices of the pizzas on-site were more expensive then the ones for delivery, although with the delivery fee this may be evened out. The t-test also comes to the same conclusion where 